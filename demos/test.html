<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>pfpgame</title>
  <meta name="generator" content="Studio 3 http://aptana.com/">
  <meta name="author" content="Neo">
  <script src="../lib/core/util.js" type="text/jscript"></script>
  <script src="../lib/core/image.js" type="text/javascript"></script>
  <script src="../lib/core/sprite.js" type="text/javascript"></script>
  <script type="text/javascript">
    var megaman = new Sprite('img/mario.png', {
      frameWidth: 115,
      frameHeight: 130,
      frameOffsetX: 1,
      frameOffsetY: 2
    });
    
    var bg = new pfImage('img/Forest_blue.jpg');

    var frame = 0;
    
    function gameGo()
    {     
      var w = document.getElementById('gameWindow');
      var cxt = w.getContext('2d');
      cxt.drawImage(bg.slice(), 0, 0);
      
      megaman.move(0, 350);
      setInterval("animate();", 100);
      //animate();
    }
    
    function animate()
    {
      if(frame > 2)
       frame = 0;
      
      if(megaman.posCurrent.x + 3 > bg.width())
        megaman.move(-bg.width(), 0);
      else
        megaman.move(3, 0);
      
      megaman.setFrame(frame, 0);
      
      var oldBGSlice = bg.slice(
        megaman.posPrevious.x, megaman.posPrevious.y,
        megaman.frameWidth(), megaman.frameHeight()
      );
            
      var mCurrent = megaman.getCurrentFrame();
      
      var w = document.getElementById('gameWindow');
      var cxt = w.getContext('2d');
      
      cxt.drawImage(oldBGSlice,
        megaman.posPrevious.x, megaman.posPrevious.y
      );
      
      cxt.drawImage(mCurrent,
        megaman.posCurrent.x, megaman.posCurrent.y
      );
      
      frame = frame + 1;
    }
  </script>
</head>
<body onload="gameGo();">

  <canvas id="gameWindow" width="640" height="480"/>

</body>
</html>
